SELECT  m.BUILD,m.VERSION,m.ADDRESSOWNER,m.NID,m.CUSTOM,  m.RECEIVERBUSINESS,m.SUFFIX,nullif(m.memo,'') as memo,m.MergeFlag, m.HANDLINGAMT,m.TaxAmt,m.reasonCode,m.EvaluateStatus,m.PAYMENTTYPE, m.SHIPTONAME,m.SHIPTOSTREET,m.SHIPTOSTREET2,m.CLOSINGDATE, ISNULL(m.SelFlag,0) AS SelFlag,m.FIRSTNAME,m.LASTNAME,m.EMAIL,m.AllGoodsDetail,m.note,m.SHIPTOCITY,m.SHIPTOSTATE,m.SHIPTOZIP,m.SHIPTOCOUNTRYCODE,m.SHIPTOCOUNTRYNAME,m.TotalWeight,m.SHIPTOPHONENUM,m.TRANSACTIONID,m.PAYMENTSTATUS,m.BUYERID,m.ACK,m.[User],m.[SUBJECT],m.ExpressNID, m.logicsWayNID, m.TrackNo,m.SHIPPINGMETHOD,m.FilterFlag,m.CheckOrder,m.Orig,m.IsPackage,m.IsChecked,m.IsPacking,m.RestoreStock,m.ORDERTIME,m.OrderTimeCN, e.name as expressname, l.name as logicsWayName,l.code as logicsWayCode,l.FileName as printfilename,c.CountryZnName,l.eub,m.scanningDate,m.weighingDate, m.ScanningMen,m.WeighingMen ,m.PackingMen,m.OrigPackingMen,m.PackageMen,m.OrigPackageMen, CASE WHEN (m.Orig = 0) AND (m.FilterFlag = 5)  THEN '等待派单' WHEN (m.Orig = 0) AND (m.FilterFlag = 6) AND (l.eub = 1)  THEN '派至E邮宝' WHEN (m.Orig = 0) AND (m.FilterFlag = 6) AND (l.eub = 2) THEN '派至E线下邮宝' WHEN (m.Orig = 0) AND (m.FilterFlag = 6) AND (l.eub = 3) THEN '派4PX独立帐户' WHEN (m.Orig = 0) AND ((m.FilterFlag = 6) AND (l.eub = 4))  THEN '派至非E邮宝' WHEN (m.Orig = 0) AND (m.FilterFlag = 20 ) THEN '未拣货' WHEN (m.Orig = 0) AND (m.FilterFlag = 22)  THEN '未核单' WHEN (m.Orig = 0) AND (m.FilterFlag = 24)  THEN '未包装' WHEN (m.Orig = 0) AND (m.FilterFlag = 40) THEN '待发货' WHEN (m.Orig = 0) AND (m.FilterFlag = 26) THEN '订单缺货(仓库)' WHEN (m.Orig = 0) AND (m.FilterFlag = 28)  THEN '缺货待包装' WHEN (m.Orig = 0) AND (m.FilterFlag = 100) THEN '已发货' WHEN  m.Orig =1 THEN '已归档' WHEN  m.Orig =3 THEN '异常已归档' WHEN  (m.Orig =2) AND (m.FilterFlag = 0) THEN '等待付款' WHEN  (m.Orig =2) AND (m.FilterFlag = 1) THEN '订单缺货' WHEN  (m.Orig =2) AND (m.FilterFlag = 2) THEN '订单退货' WHEN  (m.Orig =2) AND (m.FilterFlag = 3) THEN '订单取消' WHEN  (m.Orig =2) AND (m.FilterFlag = 4) THEN '其它异常单' END AS OrderStatus,DelayDays, AMT, CURRENCYCODE,ProfitMoney,ExpressFare INTO #AllTrade FROM (  SELECT m.BUILD,m.VERSION,m.ADDRESSOWNER,m.NID, m.RECEIVERBUSINESS, m.SUFFIX,m.SHIPTONAME,m.SHIPTOSTREET,m.SHIPTOSTREET2,m.TotalWeight, m.SelFlag,m.FIRSTNAME,m.LASTNAME,m.EMAIL,m.AllGoodsDetail,m.Memo, m.CLOSINGDATE,m.MergeFlag,m.EvaluateStatus,m.PAYMENTTYPE, case when m.TaxAmt=0 then '' else cast(cast(taxamt as Int) as varchar(20)) end as TaxAmt,m.HANDLINGAMT,m.SHIPTOCITY,m.SHIPTOSTATE,m.SHIPTOZIP,m.SHIPTOCOUNTRYCODE,m.SHIPTOCOUNTRYNAME,m.note,m.SHIPTOPHONENUM,m.TRANSACTIONID,m.PAYMENTSTATUS,m.BUYERID,m.ACK,m.[User],m.[SUBJECT],m.reasonCode,m.ExpressNID, m.logicsWayNID, m.TrackNo,m.SHIPPINGMETHOD,m.FilterFlag,m.CheckOrder,m.scanningDate,m.weighingDate,m.IsPackage,m.IsChecked,m.IsPacking,m.RestoreStock,m.ORDERTIME, dateadd(hour,8,m.ordertime) as OrderTimeCN,m.ScanningMen,m.WeighingMen ,m.PackingMen,m.OrigPackingMen,m.PackageMen,m.OrigPackageMen, 0 AS Orig , DATEDIFF(DAY,Dateadd(hour,8,ORDERTIME), GETDATE()) As DelayDays,  m.AMT,m.CURRENCYCODE,m.ProfitMoney,m.CUSTOM,m.ExpressFare FROM P_Trade(nolock) m   WHERE ordertime >= '2017-06-16 16:00:00' And ordertime <= '2017-07-17 15:59:59' And [SUFFIX] = '01-buy' and exists (SELECT top 1 1 FROM P_TradeDt(nolock) A  where A.SKU='WO07701_36' and a.tradenid=m.nid)  UNION SELECT m.BUILD,m.VERSION,m.ADDRESSOWNER,m.NID, m.RECEIVERBUSINESS, m.SUFFIX,m.SHIPTONAME,m.SHIPTOSTREET,m.SHIPTOSTREET2,m.TotalWeight, m.SelFlag,m.FIRSTNAME,m.LASTNAME,m.EMAIL,m.AllGoodsDetail,m.Memo,m.CLOSINGDATE,m.MergeBillID,m.EvaluateStatus,m.PAYMENTTYPE, case when m.TaxAmt=0 then '' else cast(cast(taxamt as Int) as varchar(20)) end as TaxAmt,m.HANDLINGAMT,m.SHIPTOCITY,m.SHIPTOSTATE,m.SHIPTOZIP,m.SHIPTOCOUNTRYCODE,m.SHIPTOCOUNTRYNAME,m.note,m.SHIPTOPHONENUM,m.TRANSACTIONID,m.PAYMENTSTATUS,m.BUYERID,m.ACK,m.[User],m.[SUBJECT],m.reasonCode,m.ExpressNID, m.logicsWayNID, m.TrackNo,m.SHIPPINGMETHOD,m.FilterFlag,m.CheckOrder,m.scanningDate,m.weighingDate,m.IsPackage,m.IsChecked,m.IsPacking,m.RestoreStock,m.ORDERTIME, dateadd(hour,8,m.ordertime) as OrderTimeCN,m.ScanningMen,m.WeighingMen ,m.PackingMen,m.OrigPackingMen,m.PackageMen,m.OrigPackageMen, 1 AS Orig , DATEDIFF(DAY,Dateadd(hour,8,ORDERTIME), GETDATE()) As DelayDays,  m.AMT,m.CURRENCYCODE,m.ProfitMoney,m.CUSTOM,m.ExpressFare FROM P_Trade_His(nolock) m   WHERE ordertime >= '2017-06-16 16:00:00' And ordertime <= '2017-07-17 15:59:59' And [SUFFIX] = '01-buy' and exists (SELECT  top 1 1  FROM P_TradeDt_His(nolock) A  where A.SKU='WO07701_36' and a.tradenid=m.nid) UNION SELECT m.BUILD,m.VERSION,m.ADDRESSOWNER,m.NID, m.RECEIVERBUSINESS, m.SUFFIX,m.SHIPTONAME,m.SHIPTOSTREET,m.SHIPTOSTREET2,m.TotalWeight, m.SelFlag,m.FIRSTNAME,m.LASTNAME,m.EMAIL,m.AllGoodsDetail,m.Memo,m.CLOSINGDATE,m.MergeBillID,m.EvaluateStatus,m.PAYMENTTYPE, case when m.TaxAmt=0 then '' else cast(cast(taxamt as Int) as varchar(20)) end as TaxAmt,m.HANDLINGAMT,m.SHIPTOCITY,m.SHIPTOSTATE,m.SHIPTOZIP,m.SHIPTOCOUNTRYCODE,m.SHIPTOCOUNTRYNAME,m.note,m.SHIPTOPHONENUM,m.TRANSACTIONID,m.PAYMENTSTATUS,m.BUYERID,m.ACK,m.[User],m.[SUBJECT],m.reasonCode,m.ExpressNID, m.logicsWayNID, m.TrackNo,m.SHIPPINGMETHOD,m.FilterFlag,m.CheckOrder,m.scanningDate,m.weighingDate,m.IsPackage,m.IsChecked,m.IsPacking,m.RestoreStock,m.ORDERTIME, dateadd(hour,8,m.ordertime) as OrderTimeCN,m.ScanningMen,m.WeighingMen ,m.PackingMen,m.OrigPackingMen,m.PackageMen,m.OrigPackageMen, 3 AS Orig , DATEDIFF(DAY,Dateadd(hour,8,ORDERTIME), GETDATE()) As DelayDays,  m.AMT,m.CURRENCYCODE,m.ProfitMoney,m.CUSTOM,m.ExpressFare FROM P_TradeUn_His(nolock) m   WHERE ordertime >= '2017-06-16 16:00:00' And ordertime <= '2017-07-17 15:59:59' And [SUFFIX] = '01-buy' and exists (SELECT  top 1 1  FROM P_TradeDtUn_His(nolock) A  where A.SKU='WO07701_36' and a.tradenid=m.nid) UNION SELECT m.BUILD,m.VERSION,m.ADDRESSOWNER,m.NID, m.RECEIVERBUSINESS,m.SUFFIX,m.SHIPTONAME,m.SHIPTOSTREET,m.SHIPTOSTREET2,m.TotalWeight, m.SelFlag,m.FIRSTNAME,m.LASTNAME,m.EMAIL,m.AllGoodsDetail,m.Memo,m.CLOSINGDATE,m.MergeFlag,m.EvaluateStatus,m.PAYMENTTYPE, case when m.TaxAmt=0 then '' else cast(cast(taxamt as Int) as varchar(20)) end as TaxAmt,m.HANDLINGAMT,m.SHIPTOCITY,m.SHIPTOSTATE,m.SHIPTOZIP,m.SHIPTOCOUNTRYCODE,m.SHIPTOCOUNTRYNAME,m.note,m.SHIPTOPHONENUM,m.TRANSACTIONID,m.PAYMENTSTATUS,m.BUYERID,m.ACK,m.[User],m.[SUBJECT],m.reasonCode,m.ExpressNID, m.logicsWayNID, m.TrackNo,m.SHIPPINGMETHOD,m.FilterFlag,m.CheckOrder,m.scanningDate,m.weighingDate,m.IsPackage,m.IsChecked,m.IsPacking,m.RestoreStock,m.ORDERTIME,dateadd(hour,8,m.ordertime) as OrderTimeCN,m.ScanningMen,m.WeighingMen ,m.PackingMen,m.OrigPackingMen,m.PackageMen,m.OrigPackageMen, 2 AS Orig , DATEDIFF(DAY,Dateadd(hour,8,ORDERTIME), GETDATE()) As DelayDays,  m.AMT,m.CURRENCYCODE,m.ProfitMoney,m.CUSTOM ,m.ExpressFare FROM P_TradeUn(nolock) m   WHERE ordertime >= '2017-06-16 16:00:00' And ordertime <= '2017-07-17 15:59:59' And [SUFFIX] = '01-buy' and exists (SELECT  top 1 1  FROM P_TradeDtUn(nolock) A  where A.SKU='WO07701_36' and a.tradenid=m.nid)  ) AS m LEFT JOIN T_express(nolock) e on e.nid=m.expressnid LEFT JOIN B_Country(nolock) c on c.CountryCode=m.SHIPTOCOUNTRYCODE LEFT JOIN B_LogisticWay(nolock) l on l.nid=m.logicsWayNID SELECT top 100000 * FROM #AllTrade m  DROP TABLE #AllTrade  if exists (select top 1 id from tempdb.dbo.sysobjects(nolock)      where id = object_id(N'tempdb..#suffixtemp') and type='U')  drop table #suffixtemp